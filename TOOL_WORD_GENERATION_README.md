# Tool: Word Document Generation

## Описание

Tool для генерации и сохранения Word документов (.docx) из текстового контента, сгенерированного нейронной сетью.

## Возможности

- Генерация Word документов из текста
- Автоматическое форматирование (заголовки, параграфы)
- Поддержка базового markdown форматирования (**жирный**, *курсив*, # заголовки)
- Использование шаблонов Word (опционально)
- Автоматическая генерация имен файлов с timestamp
- Добавление метаданных (дата генерации, пользователь) в footer документа
- Сохранение файлов на сервере с возможностью скачивания

## Установка

### 1. Установка зависимостей

Зависимость `python-docx` уже добавлена в `backend/requirements.txt`. Для установки выполните:

```bash
cd backend
pip install python-docx==1.1.2
```

Или установите все зависимости:

```bash
cd backend
pip install -r requirements.txt
```

### 2. Копирование tool-а в Open WebUI

1. Скопируйте содержимое файла `tool.py` из корневой директории проекта
2. В интерфейсе Open WebUI перейдите в раздел **Tools** (Инструменты)
3. Создайте новый tool или вставьте код в существующий
4. Сохраните изменения

## Настройка (опционально)

### Использование шаблона Word

Если вы хотите использовать собственный шаблон Word для документов:

1. Создайте директорию для шаблонов:
   ```bash
   mkdir -p backend/data/templates
   ```

2. Поместите ваш шаблон Word в эту директорию с именем `lna_template.docx`

3. Tool автоматически обнаружит и использует шаблон при генерации документов

**Поддерживаемые пути для шаблона:**
- `backend/data/templates/lna_template.docx`
- `data/templates/lna_template.docx`
- `templates/lna_template.docx`

## Использование

### Вызов tool-а через нейронную сеть

Нейронная сеть автоматически вызовет tool, когда пользователь попросит сохранить или выгрузить документ.

**Примеры запросов пользователя:**
- "Сохрани этот текст в Word документ"
- "Выгрузи этот ЛНА в файл"
- "Создай Word документ с этим содержимым"
- "Сохрани документ под названием 'Положение о премировании'"

### Параметры tool-а

Tool `generate_word_document` принимает следующие параметры:

1. **document_text** (обязательный)
   - Текстовое содержимое документа
   - Нейронка автоматически передаст сгенерированный текст

2. **document_title** (опциональный)
   - Заголовок документа
   - По умолчанию: "Untitled Document"
   - Отображается в начале документа

3. **file_name** (опциональный)
   - Пользовательское имя файла (без расширения)
   - Если не указано, генерируется автоматически из заголовка + timestamp
   - Автоматически очищается от недопустимых символов

### Пример диалога

```
Пользователь: Сгенерируй положение о премировании сотрудников

Нейронка: [генерирует текст ЛНА]

Пользователь: Отлично! Сохрани это в Word документ с названием "Положение о премировании 2025"

Нейронка: [вызывает generate_word_document с параметрами:
  - document_text: [сгенерированный текст]
  - document_title: "Положение о премировании 2025"
  - file_name: "Polozhenie_o_premirovanii_2025"
]

Результат: "Document successfully created and saved.
Filename: Polozhenie_o_premirovanii_2025_20251016_143022.docx
Path: backend/data/uploads/lna/Polozhenie_o_premirovanii_2025_20251016_143022.docx

You can download it using this path: /data/uploads/lna/Polozhenie_o_premirovanii_2025_20251016_143022.docx"
```

## Структура директорий

Файлы сохраняются в следующей структуре:

```
backend/
  data/
    uploads/
      lna/                    # Сгенерированные документы
        *.docx
    templates/               # Шаблоны Word (опционально)
      lna_template.docx
```

## Форматирование текста

Tool поддерживает базовое форматирование markdown:

### Заголовки
```
# Заголовок 1
## Заголовок 2
### Заголовок 3
```

### Форматирование текста
```
**жирный текст**
*курсивный текст*
```

### Параграфы
Параграфы разделяются двойным переносом строки:
```
Первый параграф.

Второй параграф.
```

## Метаданные

В footer каждого документа автоматически добавляется:
- Дата и время генерации
- Имя пользователя (если доступно)

Формат: `Generated on 16.10.2025 14:30 | User: Иван Иванов`

## Скачивание файлов

Файлы доступны для скачивания через веб-интерфейс Open WebUI по пути:
```
/data/uploads/lna/[имя_файла].docx
```

Файлы также доступны напрямую в файловой системе сервера:
```
backend/data/uploads/lna/[имя_файла].docx
```

## Устранение неполадок

### Ошибка: "python-docx library is not installed"

**Решение:**
```bash
cd backend
pip install python-docx==1.1.2
```

### Ошибка: "Permission denied" при сохранении файла

**Решение:**
Убедитесь, что директория существует и доступна для записи:
```bash
mkdir -p backend/data/uploads/lna
chmod 755 backend/data/uploads/lna
```

### Файлы не скачиваются через веб-интерфейс

**Проверьте:**
1. Правильность настройки статических файлов в Open WebUI
2. Доступность директории `backend/data/uploads/` для веб-сервера
3. Путь к файлу в ответе tool-а

## Ограничения

1. **Форматирование:** Поддерживается только базовое markdown форматирование
2. **Размер файла:** Очень большие тексты (>100 страниц) могут вызывать задержки
3. **Шаблоны:** Сложные шаблоны с таблицами и макросами могут работать некорректно
4. **Хранилище:** Файлы сохраняются на сервере, периодически требуется очистка старых файлов

## Дальнейшее развитие

Возможные улучшения:
- Поддержка таблиц
- Расширенное форматирование (цвета, шрифты)
- Вставка изображений
- Экспорт в PDF
- Автоматическая очистка старых файлов
- Интеграция с облачными хранилищами (Яндекс.Диск, Google Drive)

## Безопасность

- Имена файлов автоматически санитизируются (удаляются опасные символы)
- Файлы сохраняются только в разрешенных директориях
- Метаданные включают информацию о пользователе для аудита


